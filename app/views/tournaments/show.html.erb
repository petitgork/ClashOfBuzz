<% console %>

<div class="dashboard-container">
  <div>
    <p>Hey <%= current_user.nickname %>, bienvenue sur votre tableau de bord !
    <br>
    C'est ici que tu pourras gérer tes tournois et tes équipes. A toi de jouer !</p>
  </div>
  <%= link_to "+ Nouveau tournoi", new_tournament_path, class: "button" %>
  <div class="dashboard-tournaments-container">
    <div>
      <h3>Mes tournois</h3>
      <div class="dashboard-tournaments-buttons">
        <% current_user.tournaments.each do |tournament| %>
          <p><%= link_to tournament.name, tournament_path(tournament),
          class: tournament == @tournament ? "button-red" : "button"%></p>
        <% end %>
      </div>
    </div>
    <% if @tournament.status == "created" %>
      <div class="tournament">
        <p class="tournament-status">Statut : "ATTENTE DE LANCEMENT"</p>
        <h4 class="team-list-title">Liste des équipes inscrites :</h4>
        <ul class="team-list">
          <% @tournament.teams.each do |team| %>
            <li class="team"><%= team.name %> - <%= team.user.nickname %></li>
          <% end %>
        </ul>
        <h4 class="invite-title">Invite tes amis</h4>
        <div class="input-group">
          <input class="form-control" type="text" value="<%= url_for(only_path: false) %>" readonly>
          <div class="input-group-append">
            <button id="copy-button" class="btn btn-outline-primary">Copier l'invitation</button>
          </div>
        </div>
        <%= button_to 'Lancer le tournoi', launch_tournament_path(@tournament), method: :patch, class: "btn btn-launch" %>
        <% unless current_user.teams.exists?(tournament_id: @tournament.id) %>
          <%= button_to "Rejoindre le tournoi", join_tournament_path(@tournament), method: :post, class: "btn btn-join" %>
        <% end %>
      </div>
    <% else %>
      <div class="dashboard-tournaments-details-container">
        <div>
          <div class="dashboard-card">
            <p class="dashboard-title">MON EQUIPE</p>
            <% @tournament.teams.each do |team| %>
              <% if team.user == current_user %>
                <h6><%= team.name %></h6>
                <%# <%= image_tag(team.avatar, class: "team-avatar") %>
                <div id="politicCarousel" class="carousel slide">
                  <% if team.politics.count > 0 %>
                    <div class="carousel-inner">
                      <% if @politics_slice_a %>
                        <div class="dashboard-card-list carousel-item active">
                          <% @politics_slice_a.each do |politic| %>
                            <div class="dashboard-card-politic">
                              <div class="dashboard-card-politic-name">
                                <p class="last-name"><%= politic.last_name %></p>
                                <p class="first-name"><%= politic.first_name %></p>
                              </div>
                              <div>
                                <%= image_tag("avatars/#{politic.last_name.downcase.gsub("é", "e").gsub("è", "e").gsub("à", "a")}.png", class: "dashboard-card-list-avatar") %>
                              </div>
                              <p class="dashboard-card-politic-in-game">IN GAME</p>
                            </div>
                          <% end %>
                        </div>
                      <% end %>
                      <% if @politics_slice_b %>
                        <div class="dashboard-card-list carousel-item">
                          <% @politics_slice_b.each do |politic| %>
                            <div class="dashboard-card-politic">
                              <div class="dashboard-card-politic-name">
                                <p class="last-name"><%= politic.last_name %></p>
                                <p class="first-name"><%= politic.first_name %></p>
                              </div>
                              <div>
                                <%= image_tag("avatars/#{politic.last_name.downcase.gsub("é", "e").gsub("è", "e").gsub("à", "a")}.png", class: "dashboard-card-list-avatar") %>
                              </div>
                              <p class="dashboard-card-politic-in-game">IN GAME</p>
                            </div>
                          <% end %>
                        </div>
                      <% end %>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#politicCarousel" data-bs-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#politicCarousel" data-bs-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Next</span>
                    </button>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          </div>
          <%= link_to "VOIR TOUTE L'EQUIPE", tournament_team_path(@tournament, @team), class: "button" %>

        </div>
        <div>
          <div class="dashboard-card" data-controller="countdown" data-countdown-date-value="<%= @next_date %>">
            <p class="dashboard-title">CALENDRIER</p>
            <div class="dashboard-subcard">
              <h2>DEBUT</h2>
              <h2><%= @begin.strftime("%d/%m/%Y") if @begin %></h2>
              <h2>FIN</h2>
              <h2><%= @end.strftime("%d/%m/%Y") if @end %></h2>
            </div>
            <div class="dashboard-subcard">
              <h2>MATCH EN COURS</h2>
              <% if @current_match %>
                <%= button_to "#{@current_match.teams.first.name} VS #{@current_match.teams.last.name}", match_path(@current_match), method: :get, class: "button" %>
              <% else %>
                <p>Aucun match en cours</p>
              <% end %>
            </div>
            <h2>TEMPS RESTANT</h2>
            <div data-countdown-target="next" class="d-none"><%= @next_date %></div>
            <% if @next_date %>
              <div class="countdown">
                <span data-countdown-target="days"></span>J:
                <span data-countdown-target="hours"></span>h:
                <span data-countdown-target="minutes"></span>m:
                <span data-countdown-target="seconds"></span>s
              </div>
            <% else %>
              <p>Plus de match à venir</p>
            <% end %>
          </div>
          <%= link_to "VOIR TOUS MES MATCHS", matches_path(tournament_id: @tournament), class: "button" %>

        </div>
        <div>
          <div class="dashboard-card">
            <p class="dashboard-title">CLASSEMENT</p>
            <div class="ranking-group">
              <% @tournament.teams.sort_by(&:score).reverse.each_with_index do |team, id| %>
              <div class="ranking-item">
                <div>
                  <%= id + 1 %>
                </div>
                <div>
                  <% if team.name.length > 15 %>
                    | <%= team.name.first(15) %>...
                  <% else %>
                    | <%= team.name %>
                  <% end %>
                  <br>
                  | <%= team.score %> PTS
                </div>
              </div>
              <% end %>
            </div>
            <div class="player-rank">
              TU ES
              <% if @team == @tournament.teams.sort_by(&:score).reverse.first %>
                1ER !!!
                <br><br>
                <i class="fa-solid fa-crown fa-2xl" style="color: #ffffff;"></i>
              <% elsif @team == @tournament.teams.sort_by(&:score).reverse.last %>
                DERNIER !!!
                <br><br>
                <i class="fa-solid fa-frog fa-2xl" style="color: #ffffff;"></i>
              <% else %>
                <%= @tournament.teams.sort_by(&:score).reverse.find_index(@team) + 1 %>EME
                <br><br>
                <i class="fa-solid fa-bolt fa-2xl" style="color: #ffffff;"></i>
              <% end %>
            </div>
          </div>
          <div class="button">VOIR +</div>
        </div>
      </div>
    <% end %>
  </div>
</div>
